<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<link rel="stylesheet" href="/ui.css"/><title>sootypage game panel</title></head><body><div class="layout">
<div class="sidebar"><div class="brand">sootypage game panel</div>
<div class="small" id="me">Not logged in</div>
<div class="nav" style="margin-top:14px">
  <a href="/dashboard.html" data-id="dash">Dashboard</a>
  <a href="/create.html" data-id="create">Create Server</a>
  <a href="/users.html" data-id="users">Users</a>
  <a href="/settings.html" data-id="settings">Settings</a>
  <a href="#" id="logout">Logout</a>
</div></div>
<div class="main">
<div class="top">
  <div>
    <h1 style="margin:0">Dashboard</h1>
    <div class="small">Rust servers you can access.</div>
  </div>
  <div class="row">
    <a class="btn secondary" href="/create.html">+ Create</a>
  </div>
</div>

<div id="grid" class="grid"></div>

<script>
navActive("dash");
(async()=>{
  await requireMe();
  const g = document.getElementById("grid");
  g.innerHTML = "<div class='card'>Loading...</div>";
  try{
    const r = await api("/servers");
    if(!r.servers.length){ g.innerHTML = "<div class='card'>No servers yet. Create one.</div>"; return; }
    g.innerHTML = r.servers.map(s=>`
      <div class="card">
        <div style="display:flex;justify-content:space-between;gap:10px;align-items:center">
          <div>
            <div style="font-weight:800">${s.name}</div>
            <div class="small">slug: ${s.slug} ‚Ä¢ ${s.server_port}/${s.query_port}</div>
          </div>
          <a class="btn secondary" href="/server.html?slug=${encodeURIComponent(s.slug)}">Open</a>
        </div>
        <div class="kpi" style="margin-top:10px" id="kpi-${s.slug}">
          <div class="pill">CPU: ‚Ä¶</div>
          <div class="pill">RAM: ‚Ä¶</div>
        </div>
      </div>`).join("");
    for (const s of r.servers){
      setInterval(async()=>{
        try{
          const m = await api(`/servers/${encodeURIComponent(s.slug)}/metrics`);
          const el = document.getElementById(`kpi-${s.slug}`);
          const ramGB = (m.memoryBytes/1024/1024/1024).toFixed(2);
          el.innerHTML = `
            <div class="pill">${m.running?"üü¢ Running":"‚ö™ Stopped"}</div>
            <div class="pill">CPU: ${m.cpu.toFixed(1)}%</div>
            <div class="pill">RAM: ${ramGB} GB</div>`;
        }catch{}
      }, 2500);
    }
  }catch(e){
    g.innerHTML = "<div class='card'>‚ùå "+e.message+"</div>";
  }
})();
</script>
</div></div><script src="/app.js"></script>
<script>document.getElementById("logout").onclick=()=>{clearToken();location.href="/login.html";};</script></body></html>